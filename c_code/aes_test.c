#include <openssl/aes.h>
#include <openssl/rand.h>
#include <string.h>

void aes_encrypt(const unsigned char *key, const unsigned char *plaintext, unsigned char *ciphertext) {
    AES_KEY aesKey;
    AES_set_encrypt_key(key, 128, &aesKey);
    AES_encrypt(plaintext, ciphertext, &aesKey);
}

void aes_decrypt(const unsigned char *key, const unsigned char *ciphertext, unsigned char *plaintext) {
    AES_KEY aesKey;
    AES_set_decrypt_key(key, 128, &aesKey);
    AES_decrypt(ciphertext, plaintext, &aesKey);
}

int main() {
    unsigned char key[16];
    unsigned char plaintext[16] = "Hello, world!";
    unsigned char ciphertext[16];
    unsigned char decryptedtext[16];

    // Generate a random key
    if (!RAND_bytes(key, sizeof(key))) {
        fprintf(stderr, "Error generating random key\n");
        return 1;
    }

    aes_encrypt(key, plaintext, ciphertext);
    aes_decrypt(key, ciphertext, decryptedtext);

    printf("Original text: %s\n", plaintext);
    printf("Decrypted text: %s\n", decryptedtext);

    return 0;
}
